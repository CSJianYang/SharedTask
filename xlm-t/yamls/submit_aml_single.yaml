#docker's key: /r9XLj/sS40pDvIvzamSeWZHApMhEc1r
description: xlm-t

target:
  name: itplabrr1cl1
  service: amlk8s
  vc: resrchvc
  #name: itpwus2v100cl
  #service: amlk8s
  #vc: gcrprojvc1

environment:
  image: nvidia/20.09:v1
  registry: shumingdocker.azurecr.io
  setup:
  - ibstat
  - ulimit -n 4096
  - python -m pip install --editable . --user
  - python -m pip install pyarrow --user
  - python -m pip install fairscale --user
  username: shumingdocker
  
storage:
  output:
    storage_account_name: yangjianblob
    container_name: phillytools
  input:
    storage_account_name: yangjianblob
    container_name: phillytools

code:
  # local directory of the code. this will be uploaded to the server.
  # $CONFIG_DIR is expanded to the directory of this config file
  local_dir: $CONFIG_DIR/

data:
  data_upload: False
  local_dir: /home/v-jiaya/DeepTransformerModel/data/iwslt17/mTED/data-bin-fp16/
  remote_dir: DeepTransformerModel/data/iwslt17/mTED/data-bin-fp16/

jobs:  
#- name: train_xlmt_base
#  sku: G8
#  sku_count: 1
#  command:
#    - bash ./shells/aml/train_xlmt_base_single_node.sh
#- name: binary
#  sku: G0
#  sku_count: 1
#  command:
#    - bash ./shells/preprocess/binary.sh

- name: test_aml_all1
  sku: G1
  sku_count: 1
  command:
    - bash ./shells/aml/single-node/test_aml_all1.sh
    
#- name: average_checkpoint
#  sku: G0
#  sku_count: 1
#  command:
#    - bash ./average.sh